<!DOCTYPE html>
<html  lang="zh_CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>é¡¹ç›®éƒ¨ç½²è®°å½•</title>
    
      <link rel="stylesheet" href="../_static/pygments.css">
      <link rel="stylesheet" href="../_static/theme.css">
      
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>

      <!-- sphinx script_files -->
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script type="text/javascript" src="../_static/translations.js"></script>

      
      <script src="../_static/theme-vendors.js"></script>
      <script src="../_static/theme.js" defer></script>
    
  <link rel="index" title="ç´¢å¼•" href="../genindex.html" />
  <link rel="search" title="æœç´¢" href="../search.html" />
  <link rel="prev" title="ç¯å¢ƒè¦æ±‚" href="index.html" /> 
  </head>

  <body><div id="app" class="theme-container" :class="pageClasses"><navbar @toggle-sidebar="toggleSidebar">
  <router-link to="../index.html" class="home-link">
    
      <span class="site-name">monitoring</span>
    
  </router-link>

  <div class="links">
    <navlinks class="can-hide">



    </navlinks>
  </div>
</navbar>

      
      <div class="sidebar-mask" @click="toggleSidebar(false)">
      </div>
        <sidebar @toggle-sidebar="toggleSidebar">
          
          <navlinks>
            



            
          </navlinks><div id="searchbox" class="searchbox" role="search">
  <div class="caption"><span class="caption-text">å¿«é€Ÿæœç´¢</span>
    <div class="searchformwrapper">
      <form class="search" action="../search.html" method="get">
        <input type="text" name="q" />
        <input type="submit" value="æœç´¢" />
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div><div class="sidebar-links" role="navigation" aria-label="main navigation">
  
    <div class="sidebar-group">
      <p class="caption">
        <span class="caption-text"><a href="../contents.html#id1">ç›®å½•</a></span>
      </p>
      <ul class="current">
        
          <li class="toctree-l1 "><a href="../main/index.html" class="reference internal ">é¡¹ç›®è®¾è®¡</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="../dev/index.html" class="reference internal ">å¼€å‘æ–‡æ¡£</a>

            
          </li>

        
          <li class="toctree-l1 "><a href="index.html" class="reference internal ">ç¯å¢ƒè¦æ±‚</a>

            
          </li>

        
          <li class="toctree-l1 current"><a href="#" class="reference internal current">é¡¹ç›®éƒ¨ç½²è®°å½•</a>

            
              <ul>
                
                  <li class="toctree-l2"><a href="#python" class="reference internal">ç¬¬ä¸€æ­¥ pythonè¿è¡Œç¯å¢ƒ</a></li>
                
                  <li class="toctree-l2"><a href="#id2" class="reference internal">ç¬¬äºŒæ­¥ æ•°æ®åº“å‡†å¤‡ä¸é…ç½®</a></li>
                
                  <li class="toctree-l2"><a href="#supervisord" class="reference internal">ç¬¬ä¸‰æ­¥ é…ç½®supervisordè¿è¡Œé¡¹ç›®</a></li>
                
                  <li class="toctree-l2"><a href="#nginx" class="reference internal">ç¬¬å››æ­¥ é…ç½®nginx</a></li>
                
              </ul>
            
          </li>

        
      </ul>
    </div>
  
</div>
        </sidebar>

      <page>
          <div class="body-header" role="navigation" aria-label="navigation">
  
  <ul class="breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
    
      <li><a href="../contents.html">ç›®å½•</a> &raquo;</li>
    
      <li><a href="index.html">ç¯å¢ƒè¦æ±‚</a> &raquo;</li>
    
    <li>é¡¹ç›®éƒ¨ç½²è®°å½•</li>
  </ul>
  

  <ul class="page-nav">
  <li class="prev">
    <a href="index.html"
       title="ä¸Šä¸€ç« ">â† ç¯å¢ƒè¦æ±‚</a>
  </li>
</ul>
  
</div>
<hr>
          <div class="content" role="main">
            
  <div class="section" id="id1">
<h1>é¡¹ç›®éƒ¨ç½²è®°å½•<a class="headerlink" href="#id1" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h1>
<p>é¡¹ç›®ç»“æ„å¦‚ä¸‹:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>apudeMacBook-Pro:rd apuyuseng$ tree -L 2
.
â”œâ”€â”€ BaiduShareSpider
â”‚Â Â  â”œâ”€â”€ LICENSE
â”‚Â Â  â”œâ”€â”€ __pycache__
â”‚Â Â  â”œâ”€â”€ conf
â”‚Â Â  â”œâ”€â”€ export.py
â”‚Â Â  â”œâ”€â”€ export.sh
â”‚Â Â  â”œâ”€â”€ login.py
â”‚Â Â  â”œâ”€â”€ mail.py
â”‚Â Â  â”œâ”€â”€ main.py
â”‚Â Â  â”œâ”€â”€ models
â”‚Â Â  â”œâ”€â”€ outmc.py
â”‚Â Â  â”œâ”€â”€ pcloud.html
â”‚Â Â  â”œâ”€â”€ requirements.txt
â”‚Â Â  â”œâ”€â”€ screenshot
â”‚Â Â  â””â”€â”€ test_get_token.py
â”œâ”€â”€ chromedriver
â”œâ”€â”€ monitoring
â”‚Â Â  â”œâ”€â”€ Dockerfile
â”‚Â Â  â”œâ”€â”€ Dockerfile_base
â”‚Â Â  â”œâ”€â”€ Dockerfile_web
â”‚Â Â  â”œâ”€â”€ README.md
â”‚Â Â  â”œâ”€â”€ asm
â”‚Â Â  â”œâ”€â”€ assistant.py
â”‚Â Â  â”œâ”€â”€ bin
â”‚Â Â  â”œâ”€â”€ conf
â”‚Â Â  â”œâ”€â”€ download
â”‚Â Â  â”œâ”€â”€ env
â”‚Â Â  â”œâ”€â”€ froala
â”‚Â Â  â”œâ”€â”€ lib
â”‚Â Â  â”œâ”€â”€ model
â”‚Â Â  â”œâ”€â”€ monitoring.ini
â”‚Â Â  â”œâ”€â”€ requirements.txt
â”‚Â Â  â”œâ”€â”€ start.sh
â”‚Â Â  â”œâ”€â”€ supervisord.conf
â”‚Â Â  â”œâ”€â”€ supervisord.pid
â”‚Â Â  â”œâ”€â”€ tasks
â”‚Â Â  â”œâ”€â”€ view
â”‚Â Â  â”œâ”€â”€ www
â”‚Â Â  â””â”€â”€ z
â”œâ”€â”€ scrapyd
â”‚Â Â  â”œâ”€â”€ Dockerfile
â”‚Â Â  â”œâ”€â”€ LICENSE
â”‚Â Â  â”œâ”€â”€ README.md
â”‚Â Â  â”œâ”€â”€ requirements.txt
â”‚Â Â  â”œâ”€â”€ scrapyd.conf
â”‚Â Â  â””â”€â”€ start.sh
â””â”€â”€ supervisord.conf
</pre></div>
</div>
<div class="section" id="python">
<h2>ç¬¬ä¸€æ­¥ pythonè¿è¡Œç¯å¢ƒ<a class="headerlink" href="#python" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<ol class="arabic">
<li><p>éš”ç¦»è¿è¡Œç¯å¢ƒ:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ pip3 install virtualenv
$ virtualenv  --no-site-packages venv
</pre></div>
</div>
</li>
<li><p>å®‰è£…ç¬¬ä¸‰æ–¹åº“:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ source ./venv/bin/activate
$ pip3 install -r monitoring/requirements.txt
$ pip3 install -r BaiduShareSpider/requirements.txt
$ pip3 install scrapyd w3lib requests Twisted==18.7.0
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="id2">
<h2>ç¬¬äºŒæ­¥ æ•°æ®åº“å‡†å¤‡ä¸é…ç½®<a class="headerlink" href="#id2" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<ol class="arabic">
<li><p>åˆ›å»ºæ•°æ®åº“:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>(venv) apudeMacBook-Pro:rd apuyuseng$ psql
psql (11.3)
Type &quot;help&quot; for help.

apuyuseng=# CREATE USER apu PASSWORD &#39;yuyuan132&#39; CREATEDB;
apuyuseng=#CREATE DATABASE monitoring WITH ENCODING=&#39;UTF8&#39; OWNER=apu TEMPLATE=template1 CONNECTION LIMIT=-1;
</pre></div>
</div>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">å°æŠ€å·§</p>
<p>è¿™æ˜¯åˆ›å»ºæ•°æ®åº“åŠåˆ†é…æƒé™</p>
<p>å…¶ä¸­ <cite>apu</cite> ç”¨æˆ·å <cite>yuyuan132</cite> æ˜¯å¯†ç ï¼Œ <cite>monitoring</cite> æ˜¯æ•°æ®åº“åï¼Œå½“ç„¶å¼ºçƒˆå»ºè®®æ›´æ”¹ï¼Œæ›´æ”¹åè¯·ä¿®æ”¹å¯¹åº”é¡¹ç›®çš„æ•°æ®åº“é…ç½®æ–‡ä»¶ï¼Œä¸€èˆ¬çš„éƒ½ä¼šæ”¾åœ¨project/conf/base.toml,åœ¨é…ç½®æ–‡ä»¶ä¸­æœ‰ç›¸åº”çš„ä»‹ç»ã€‚
æ•°æ®åº“çš„ç›¸å…³è®¾ç½®å’Œè¯­æ³•è¯·æŸ¥çœ‹postgresqlã€‚</p>
</div>
<ol class="arabic" start="2">
<li><p>åˆ›å»ºé¡¹ç›®è¡¨å’Œå¯¼å…¥ç³»ç»Ÿé»˜è®¤æ•°æ®:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cd monitoring
$ python3 assistant.py schema
$ python3 assistant.py data
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="supervisord">
<h2>ç¬¬ä¸‰æ­¥ é…ç½®supervisordè¿è¡Œé¡¹ç›®<a class="headerlink" href="#supervisord" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>è¯¦ç»†é…ç½®è¯·åˆ°supervisordå®˜ç½‘æŸ¥çœ‹
è¿™é‡Œæˆ‘ä»¬éœ€è¦æ›´æ”¹ <cite>directory</cite> ä¸ºæˆ‘ä»¬ç›¸åº”é¡¹ç›®è·¯å¾„</p>
<p>å¦‚æˆ‘çš„:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">supervisord</span><span class="p">]</span>
<span class="p">[</span><span class="n">supervisorctl</span><span class="p">]</span>
<span class="p">[</span><span class="n">inet_http_server</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">9001</span>
<span class="n">username</span> <span class="o">=</span> <span class="n">admin</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">admin</span>


<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">celery_worker</span><span class="p">]</span>
<span class="n">command</span><span class="o">=</span><span class="n">celery</span> <span class="o">-</span><span class="n">A</span> <span class="nb">bin</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">celery</span> <span class="n">worker</span> <span class="o">--</span><span class="n">loglevel</span><span class="o">=</span><span class="n">info</span>
<span class="n">directory</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">apuyuseng</span><span class="o">/</span><span class="n">rd</span><span class="o">/</span><span class="n">monitoring</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>
<span class="n">redirect_stderr</span><span class="o">=</span><span class="n">true</span>


<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">celery_beat</span><span class="p">]</span>
<span class="n">command</span><span class="o">=</span><span class="n">celery</span> <span class="o">-</span><span class="n">A</span> <span class="nb">bin</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">celery</span> <span class="n">beat</span> <span class="o">--</span><span class="n">loglevel</span><span class="o">=</span><span class="n">info</span>
<span class="n">directory</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">apuyuseng</span><span class="o">/</span><span class="n">rd</span><span class="o">/</span><span class="n">monitoring</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>
<span class="n">redirect_stderr</span><span class="o">=</span><span class="n">true</span>


<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">monitoring</span><span class="p">]</span>
<span class="n">command</span><span class="o">=</span><span class="n">gunicorn</span> <span class="o">--</span><span class="n">workers</span><span class="o">=</span><span class="mi">8</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="n">error</span> <span class="o">--</span><span class="n">bind</span><span class="o">=</span><span class="mf">0.0</span><span class="o">.</span><span class="mf">0.0</span><span class="p">:</span><span class="mi">8000</span> <span class="o">-</span><span class="n">k</span> <span class="n">flask_sockets</span><span class="o">.</span><span class="n">worker</span> <span class="nb">bin</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">wsgi</span><span class="p">:</span><span class="n">app</span>
<span class="n">directory</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">apuyuseng</span><span class="o">/</span><span class="n">rd</span><span class="o">/</span><span class="n">monitoring</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>
<span class="n">redirect_stderr</span><span class="o">=</span><span class="n">true</span>

<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">chromedriver</span><span class="p">]</span>
<span class="n">command</span><span class="o">=./</span><span class="n">chromedriver</span> <span class="o">--</span><span class="n">whitelisted</span><span class="o">-</span><span class="n">ips</span> <span class="o">--</span><span class="n">log</span><span class="o">-</span><span class="n">level</span><span class="o">=</span><span class="n">INFO</span>
<span class="n">autostart</span><span class="o">=</span><span class="n">true</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>

<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">BaiduShareSpider</span><span class="p">]</span>
<span class="n">command</span><span class="o">=</span><span class="n">python3</span> <span class="n">main</span><span class="o">.</span><span class="n">py</span>
<span class="n">directory</span><span class="o">=/</span><span class="n">Users</span><span class="o">/</span><span class="n">apuyuseng</span><span class="o">/</span><span class="n">rd</span><span class="o">/</span><span class="n">BaiduShareSpider</span>
<span class="n">autostart</span><span class="o">=</span><span class="n">true</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>

<span class="p">[</span><span class="n">program</span><span class="p">:</span><span class="n">scrapyd</span><span class="p">]</span>
<span class="n">command</span><span class="o">=</span><span class="n">scrapyd</span>
<span class="n">autostart</span><span class="o">=</span><span class="n">true</span>
<span class="n">autorestart</span><span class="o">=</span><span class="n">true</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">å°æŠ€å·§</p>
<p>supervisordçš„é…ç½®ä¸æ­¢è¿™ä¹ˆç®€å•</p>
<p>å¯ä»¥æ ¹æ®éœ€æ±‚è®¾ç½®æ—¥å¿—çš„å­˜å‚¨ã€é‡è¯•æ¬¡æ•°ç­‰ã€‚</p>
</div>
<p><strong>è¿è¡Œ</strong> :åœ¨ç»ˆç«¯ç›´æ¥æ‰§è¡Œ <cite>supervisord</cite>
è®¿é—® <a class="reference external" href="http://127.0.0.1:9001">http://127.0.0.1:9001</a>
ç™»é™†è´¦å·å¯†ç æ˜¯ <cite>admin</cite> ï¼Œè¿™ä¸ªåœ¨ä¸Šè¿°é…ç½®ä¸­å¯ä»¥é…ç½®çš„</p>
<img alt="../_images/supervisord.png" src="../_images/supervisord.png" />
</div>
<div class="section" id="nginx">
<h2>ç¬¬å››æ­¥ é…ç½®nginx<a class="headerlink" href="#nginx" title="æ°¸ä¹…é“¾æ¥è‡³æ ‡é¢˜">Â¶</a></h2>
<p>å¯ä»¥é€šè¿‡ <cite>nginx -t</cite> çŸ¥é“é…ç½®æ–‡ä»¶è·¯å¾„ <cite>/usr/local/etc/nginx/nginx.conf</cite></p>
<p>æˆ‘çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>server {
    listen       80;
    server_name  localhost;

    #charset koi8-r;

    #access_log  logs/host.access.log  main;
    access_log  /var/log/nginx/monitoring.access.log;
    error_log  /var/log/nginx/monitoring.error.log;
    location /project/baidu_spider/run {
         proxy_pass http://0.0.0.0:8000/project/baidu_spider/run;
         proxy_http_version 1.1;
         proxy_set_header Upgrade $http_upgrade;
         proxy_set_header Connection &quot;upgrade&quot;;

    }

    location / {
           proxy_pass http://0.0.0.0:8000/;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header REMOTE-HOST $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
    location /res/ {
        alias /Users/apuyuseng/rd/monitoring/www/;
        rewrite ^(.*)\.md5_[^.]*\.(css|js)$ $1.$2 last;

    }
}
</pre></div>
</div>
<p>å…¶ä¸­å°†è·¯å¾„ä¿®æ”¹æˆé¡¹ç›®è·¯å¾„</p>
<div class="admonition tip">
<p class="admonition-title">å°æŠ€å·§</p>
<p>nginxæ˜¯æ–¹å‘ä»£ç†çš„å¥½å¸®æ‰‹</p>
<p>nginxé…ç½®å¾ˆå¼ºå¤§ã€å¯ä»¥æ ¹æ®éœ€æ±‚é…ç½®ã€å¦‚æ—¥å¿—ã€ç¼“å­˜ã€é™åˆ¶ipã€ç™»é™†ç­‰ç­‰ï¼Œè‹¥éœ€è¦è¯·åˆ°å®˜ç½‘æŸ¥çœ‹ç›¸åº”é…ç½®ã€‚</p>
</div>
<p>åˆ°æ­¤éƒ¨ç½²å·²ç»å®Œæˆã€‚ğŸ˜„</p>
</div>
</div>


          </div>
          <div class="page-nav">
            <div class="inner"><ul class="page-nav">
  <li class="prev">
    <a href="index.html"
       title="ä¸Šä¸€ç« ">â† ç¯å¢ƒè¦æ±‚</a>
  </li>
</ul><div class="footer" role="contentinfo">
      &#169; ç‰ˆæƒæ‰€æœ‰ 2019, apuyuseng.
    <br>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.1 with <a href="https://github.com/schettino72/sphinx_press_theme">Press Theme</a>.
</div>
            </div>
          </div>
      </page>
  </div></body>
</html>